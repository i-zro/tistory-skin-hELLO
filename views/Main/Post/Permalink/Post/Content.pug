article#content(
  x-ref='content'
  class='relative')
  div(x-data='content')
    s_if_var_toc
      include Content/TOC
    #article(x-ref='article')
      //- div(id="adblock-detector" class="xl:w-[620px] w-[340px] xl:h-[88px] h-[188px] fixed z-40 xl:left-[calc(50%+128px)] left-[50%] xl:bottom-[20px] bottom-[16px] translate-x-[-50%] hidden xl:flex-row flex-col xl:justify-center justify-start items-center rounded-[12px] bg-h-yellow dark:bg-b-purple shadow-lg")
        svg(class="w-[60px] xl:mt-0 mt-[4px]" xmlns="http://www.w3.org/2000/svg" viewBox="-92.8875 -155.125 805.025 930.75")
          path(fill="#fff" d="M44.447 196.236h525.279V422.51H44.447z")
          path(d="M91.81 528.684L1.5 438.37V182.12l90.316-90.31L182.13 1.5h255l90.31 90.316 90.309 90.315v256.25l-90.316 90.31L437.12 619h-255zm416.249-20.618l82.191-82.184V194.618l-82.191-82.184-82.191-82.184H194.585l-82.165 82.187-82.165 82.188-.003 115.621-.003 115.622 82.184 82.19 82.184 82.192h231.25l82.191-82.184z" fill="#fff" stroke="#dadbdb" stroke-width="3")
          path(d="M111.937 508.642L30.17 427.077V193.328l81.774-81.558 81.774-81.559h231.826l82.4 82.184 82.4 82.183v231.263l-82.4 82.183-82.4 82.184h-231.84zm231.415-94.193c31.219-6.721 48.918-26.184 51.101-56.193 1.476-20.286-4.536-37.721-16.17-46.893-5.575-4.397-17.604-9.903-21.63-9.903-3.286 0-3.16-2.23.173-3.064 10.03-2.51 21.359-14.961 25.484-28.005 3.075-9.726 3.399-27.999.658-37.203-2.656-8.923-10.244-19.1-18.229-24.45-14.389-9.64-31.542-12.169-82.992-12.236l-32.27-.042v220.624l42.295-.318c33.11-.25 44.312-.752 51.58-2.317zm-50.013-64.75v-28.24h16.691c18.677 0 27.147 1.788 33.422 7.055 6.013 5.046 7.938 9.906 7.945 20.056.01 13.01-3.657 19.712-13.548 24.76-7.032 3.59-8.163 3.773-25.931 4.181l-18.579.427zm0-88.861v-24.623l16.605.442c18.386.49 24.156 2.27 29.056 8.961 3.943 5.385 3.733 22.128-.359 28.693-4.985 7.997-10.806 10.116-29.323 10.67l-15.979.48zM100.83 395.52c2.586-11.515 5.25-23.046 5.919-25.624l1.216-4.688h57.345l2.735 12.187a4761.206 4761.206 0 005.848 25.625l3.11 13.438h23.214c18.02 0 23.093-.35 22.678-1.563-.294-.86-13.718-50.078-29.83-109.374L163.769 197.71h-52.803l-3.416 12.813c-4.811 18.044-54.724 201.092-55.558 203.748-.636 2.028.954 2.188 21.725 2.188h22.411zm16.303-72.5c1.793-5.937 8.918-37.523 13.746-60.936 3.24-15.715 5.725-25.247 6.193-23.75.43 1.375 3.048 13.187 5.82 26.25 2.77 13.062 6.949 32.046 9.284 42.187l4.246 18.437h-19.975c-18.44 0-19.924-.168-19.314-2.187zm350.4 56.563v-36.875h17.435c21.162 0 33.798-2.215 46.232-8.105 17.523-8.3 31.24-26.219 35.421-46.27 2.25-10.786 1.95-33.299-.573-43.124-6.384-24.861-22.817-40.238-48.648-45.523-7.678-1.571-18.279-1.977-51.694-1.977h-42.034V416.46h43.86zm0-109.374v-32.5h16.691c19.82 0 27.703 1.864 33.863 8.008 5.566 5.552 7.552 13.11 6.84 26.037-1.288 23.43-11.487 30.954-41.956 30.954h-15.438z" fill="#e00000" stroke="#cb0000" stroke-width="3.004")
        div(class="xl:ml-[10px] ml-0 xl:mt-0 mt-[4px] xl:mb-0 mb-[16px] xl:text-[16px] text-[14px] xl:text-left text-center")
          div() 가독성을 해치지 않을만큼의 광고만 개제되어 있습니다.
          div(class="flex")
            div(class="font-bold") AdBlock을 비활성화
            div(class="ml-[6px]") 후 이용해주시면 감사하겠습니다!
        button(class="xl:h-[40px] h-[34px] px-[18px] xl:ml-[36px] ml-0 rounded-[12px] xl:text-[16px] text-[14px] text-h-800 dark:text-b-900 bg-h-200 lg:hover:bg-h-200/80 hover:bg-200 dark:bg-b-deeppurple lg:hover:dark:bg-b-deeppurple/80 hover:dark:bg-b-deeppurple" onclick="location.reload()") 새로고침
      template(
        x-ref='articleTemplate'
        x-teleport='#article')
        div
          | #{`[##_${type}_rep_desc_##]`}
          include Content/Subscription
    s_if_var_scrollspy
      include Content/Scrollspy

script(once='alpine-content-component').
  document.addEventListener('alpine:init', () => Alpine.data('content', () => ({
    /**
     * Support Headings
     *
     * @property {array} headings
     */
    supportHeadings: '.contents_style > h2, .contents_style > h3',

    /**
     * Headings
     *
     * @property {array} headings
     */
    headings: [],

    /**
     * Init 'content' Component
     */
    init () {
      this.setAnchorToHeadings()
      this.collectHeading()

      this.setLazyLoadToImages()
      this.setRatioToImages()
      this.setPositionToImages()

      this.highlightCodeBlocks()
    },

    /**
     * Syntax highlighting code blocks in template
     */
    highlightCodeBlocks () {
      this.$article.querySelectorAll('pre code').forEach(hljs.highlightElement)
    },

    /**
     * Collect heading in template
     */
    collectHeading () {
      this.$headings.forEach($heading => {
        const heading = this.heading($heading)

        this.headings.push(heading)
      })
    },

    /**
     * Get new Scrollspy item
     *
     * @param {HTMLElement} $heading
     *
     * @return {object}
     */
    heading ($heading) {
      return {
        tagName: $heading.tagName,
        id: $heading.id,
        href: `#${$heading.id}`,
        text: $heading.textContent,
        active: false
      }
    },

    /**
     * Set lazy load to images in template
     */
    setLazyLoadToImages () {
      this.$article.querySelectorAll('figure[class^=image] img').forEach(this.setLazyLoadToImage)
    },

    /**
     * Set lazy load to image
     *
     * @param {object} $image
     */
    setLazyLoadToImage ($image) {
      $image.classList.add('lazyload')

      $image.dataset.src = $image.getAttribute('src')
      $image.dataset.srcset = $image.getAttribute('srcset')
      $image.dataset.sizes = 'auto'

      $image.removeAttribute('src')
      $image.removeAttribute('srcset')
    },

    /**
     * set Ratio to images in template
     */
    setRatioToImages () {
      this.$article.querySelectorAll('figure.imageslideblock').forEach(this.setRatioToImageSlideBlock.bind(this))
      this.$article.querySelectorAll('figure.imageblock').forEach(this.setRatioToImageBlock.bind(this))
      this.$article.querySelectorAll('figure.imagegridblock').forEach(this.setRatioToImageGridBlock.bind(this))
    },

    /**
     * Set Ratio to image block
     *
     * @param {HTMLElement} $imageBlock
     */
    setRatioToImageBlock ($imageBlock) {
      const $imageWrap = $imageBlock.querySelector('span, a')
      const $image = $imageWrap.querySelector('img')

      const paddingBottom = this.ratio($imageBlock, $image)

      $imageWrap.style.paddingBottom = `${paddingBottom}%`
    },

    /**
     * Set Ratio to image grid block
     *
     * @param {HTMLElement} $imageBlock
     */
    setRatioToImageGridBlock ($imageBlock) {
      const $imageWraps = $imageBlock.querySelectorAll('span, a')

      $imageWraps.forEach($imageWrap => {
        const $image = $imageWrap.querySelector('img')

        const paddingBottom = this.ratio($imageWrap, $image)

        $imageWrap.style.paddingBottom = `${paddingBottom}%`
      })
    },

    /**
     * Set Ratio to image slide block
     *
     * @param {HTMLElement} $imageBlock
     */
    setRatioToImageSlideBlock ($imageBlock) {
      const $imageWrap = $imageBlock.querySelector('.image-container')
      const $image = $imageWrap.querySelector('img')

      const paddingBottom = this.ratio($image, $image)

      $imageWrap.style.paddingBottom = `${paddingBottom}%`
    },

    /**
     * Get ratio
     *
     * @param {HTMLElement} $originBlock
     * @param {HTMLElement} $image
     *
     * @return {number}
     */
    ratio ($originBlock, $image) {
      let width = $originBlock.dataset.originWidth
      let height = $originBlock.dataset.originHeight

      if ($image.hasAttribute('width') && $image.hasAttribute('height')) {
        width = $image.getAttribute('width')
        height = $image.getAttribute('height')
      }

      width = $originBlock.dataset.widthpercent
        ? width * (100 / $originBlock.dataset.widthpercent)
        : width

      return height / width * 100
    },

    /**
     * Set position to images
     */
    setPositionToImages () {
      this.$article.querySelectorAll('figure.imageblock').forEach(this.setImageBlockPosition.bind(this))
      this.$article.querySelectorAll('figure.imagegridblock').forEach(this.setImageGridBlockPosition.bind(this))
    },

    /**
     * Set image block position
     *
     * @param {HTMLElement} $imageBlock
     */
    setImageBlockPosition ($imageBlock) {
      const width = this.imageBlockWidth($imageBlock)

      if ($imageBlock.classList.contains('alignCenter')) {
        this.setImageBlockToCenter($imageBlock, width)
      }

      if ($imageBlock.classList.contains('widthContent')) {
        return
      }

      this.setImageBlockWidth($imageBlock, width)
    },

    /**
     * Set image grid block position
     *
     * @param {HTMLElement} $imageBlock
     */
    setImageGridBlockPosition ($imageBlock) {
      const width = this.imageGridBlockWidth()

      this.setImageBlockToCenter($imageBlock, width)
      this.setImageBlockWidth($imageBlock, width)
    },

    /**
     * Center image block
     *
     * @param {HTMLElement} $imageBlock
     */
    imageBlockWidth ($imageBlock) {
      const $imageWrap = $imageBlock.querySelector('span, a')
      const $image = $imageWrap.querySelector('img')
      const width = $image.getAttribute('width') || $imageBlock.dataset.originWidth

      return width > 1100 ? 1100 : width
    },

    /**
     * Center image grid block
     */
    imageGridBlockWidth () {
      return 1100
    },

    /**
     * set Image Width
     *
     * @param {HTMLElement} $imageBlock
     * @param {String|Number} width
     */
    setImageBlockWidth ($imageBlock, width) {
      $imageBlock.style.width = `${width}px`
    },

    /**
     * set Image block to center
     *
     * @param {HTMLElement} $imageBlock
     * @param {String|Number} width
     */
    setImageBlockToCenter ($imageBlock, width) {
      $imageBlock.style.marginLeft = `calc(50% - ${width / 2}px)`
    },

    /**
     * Set anchor to headings in template
     */
    setAnchorToHeadings () {
      this.$headings.forEach(this.setAnchorToHeading.bind(this))
    },

    /**
     * Set anchor to heading
     *
     * @param {HTMLElement} $heading
     */
    setAnchorToHeading ($heading) {
      const link = this.link($heading)
      const $anchor = this.$anchor($heading, `#${link}`)

      $heading.setAttribute('id', link)
      $heading.innerHTML = $anchor.outerHTML
    },

    /**
     * Get link for heading
     *
     * @param {HTMLElement} $heading
     *
     * @return {string}
     */
    link ($heading) {
      return this.$id(encodeURIComponent($heading.textContent))
    },

    /**
     * Get new anchor
     *
     * @param {HTMLElement} $heading
     * @param {string} link
     *
     * @return {HTMLElement}
     */
    $anchor ($heading, link) {
      const $anchor = document.createElement('a')

      $anchor.setAttribute('href', link)
      $anchor.textContent = $heading.textContent

      return $anchor
    },

    /**
     * Get article template content
     *
     * @return {HTMLElement}
     */
    get $article () {
      return this.$refs.articleTemplate.content
    },

    /**
     * Get headings in content
     *
     * @return {NodeListOf<HTMLElement>}
     */
    get $headings () {
      return this.$article.querySelectorAll(this.supportHeadings)
    }
  })))

style(once='content')
  :postcss
    #content {
      .contents_style {
        @apply text-left pt-8 border-t border-t-h-600 dark:border-t-b-400 leading-loose text-h-200 dark:text-b-900;

        .another_category {
          @apply p-8 rounded-[12px] border border-h-200 dark:border-b-400;
        }
        
        a {
          @apply text-h-200 dark:text-b-900 decoration-0;
        }

        h2,
        h3,
        h4 {
          @apply my-5 font-medium scroll-mt-20;

          a {
            @apply text-h-200 dark:text-b-900;
          }
        }

        h2 {
          @apply text-xl lg:text-2xl mb-3;
        }

        h3 {
          @apply text-lg lg:text-xl;
        }

        h4 {
          @apply text-base lg:text-lg;
        }

        ol[data-ke-list-type],
        ul[data-ke-list-type] {
          @apply flex flex-col gap-y-1 list-inside my-5;

          ol[data-ke-list-type],
          ul[data-ke-list-type] {
            @apply my-0 ml-6;
          }
        }

        p,
        ol[data-ke-list-type],
        ul[data-ke-list-type],
        table[data-ke-align],
        blockquote[data-ke-style=style2],
        blockquote[data-ke-style=style3] {
          @apply text-h-200 dark:text-b-800;

          b,
          strong {
            @apply font-bold dark:text-b-900;
          }

          a {
            @apply inline-block text-b-blue hover:underline;
          }

          code {
            @apply relative -top-[1px] px-2 py-0.5 rounded-md whitespace-normal text-sm font-sans text-h-300 bg-h-700;
          }
        }

        figure,
        pre,
        table[data-ke-align],
        [data-ke-type=moreLess] {
          @apply my-3;
        }

        figure {
          @apply my-1;
        }

        hr {
          @apply invert brightness-0;
        }

        table[data-ke-align] {
          tr {
            @apply border-t border-h-600 dark:border-b-400
          }

          td,
          th {
            @apply bg-transparent border-0 border-b border-h-600 dark:border-b-400 p-3 box-border text-sm leading-normal text-h-200 dark:text-b-900;
          }
        }

        figure {
          figcaption {
            @apply text-h-500 dark:text-b-700 text-center text-sm leading-loose;
          }

          img {
            @apply rounded-[12px];
          }

          &.imageblock.alignCenter,
          &.imagegridblock {
            @apply max-w-none max-lg:w-full max-lg:mx-0 !important;
          }

          &.imageblock,
          &.imagegridblock {
            span,
            a {
              @apply block relative max-w-full max-h-full w-auto h-auto;

              &::after {
                @apply content-[''] block h-0 w-full;
              }

              img {
                @apply absolute top-0 left-0 w-full h-full block;
              }
            }
          }

          &.imageslideblock {
            .image-container {
              @apply min-h-0 max-w-full max-h-full w-auto h-auto !important;

              &::after {
                @apply content-[''] block h-0 w-full;
              }

              .selected  {
                @apply absolute top-0 left-0 max-w-full max-h-full w-full h-full flex justify-center items-center;

                img {
                  @apply w-auto h-auto block;
                }
              }
            }
          }

          &[data-ke-type=opengraph] {
            a {
              @apply border-0;

              .og-image {
                @apply border-r-0 rounded-l-[12px] overflow-hidden;
              }
            }

            .og-text {
              @apply bg-h-700/60 dark:bg-b-350/60 rounded-r-[12px];

              .og-title,
              .og-desc,
              .og-host {
                @apply text-h-200 dark:text-b-900 font-sans font-bold;
              }

              .og-desc,
              .og-host {
                @apply text-h-400 dark:text-b-800 font-normal;
              }
            }
          }

          &.fileblock {
            @apply rounded-xl border-0 bg-h-700/60 dark:bg-b-400;

            .filename {
              @apply mt-3;

              .name {
                @apply h-auto;
              }
            }

            .filename,
            .size {
              @apply text-h-200 dark:text-b-900;
            }

            .image,
            a::after {
              @apply invert brightness-0;
            }
          }
        }

        [data-ke-type=moreLess] {
          @apply relative;

          &::before {
            @apply content-[''] absolute top-4 right-0 w-full h-0 w-full -z-[1] border-b border-dashed border-h-600 dark:border-b-400;
          }

          &.open {
            .btn-toggle-moreless::before {
              @apply fa-circle-arrow-down;
            }
          }

          .btn-toggle-moreless {
            @apply bg-h-700/60 dark:bg-b-400 text-h-200 dark:text-b-900 text-sm font-bold rounded-xl px-3 py-1 inline-block;

            &::before {
              @apply mr-1.5 fa-circle-arrow-right;
            }
          }

          .moreless-content {
            @apply mt-6;
          }
        }

        blockquote[data-ke-style] {
          @apply font-[initial] my-4 text-h-500 dark:text-b-800 font-sans;

          &[data-ke-style=style1] {
            @apply font-medium text-xl pt-7 leading-loose text-h-500 dark:text-b-800;
          }

          &[data-ke-style=style2] {
            @apply border-l-2 border-solid border-h-600 dark:border-b-800 pl-3 pr-1 text-h-500 dark:text-b-800 text-left text-sm leading-loose;
          }

          &[data-ke-style=style3] {
            @apply border-0 text-h-500 dark:text-b-800 bg-h-700/60 dark:bg-b-800 leading-loose rounded-xl;
          }
        }

        pre {
          code {
            @apply px-8 py-4 leading-normal rounded-[12px];

            &.hljs {
              @apply bg-h-700/60 dark:bg-b-350/60 text-h-400 dark:text-b-800 text-sm;
            }
          }
        }
      }
    }

style(once='content-postbtn')
  :postcss
    #content {
      .container_postbtn {
        @apply p-0 pt-8 mt-8 border-t border-h-600 dark:border-b-400 text-b-900;

        .postbtn_like > .wrap_btn:not([id^=reaction-]) > button,
        .btn_subscription {
          @apply w-9 h-9 inline-block shadow-none outline-0 rounded-md cursor-pointer leading-none text-[0] p-0 bg-h-700/60 hover:bg-h-yellow dark:bg-b-350 hover:dark:bg-b-purple before:text-h-400 before:dark:text-b-900;
        }

        .postbtn_like > .wrap_btn:not([id^=reaction-]) > button:hover,
        .btn_subscription:hover {
          @apply before:text-h-200 before:dark:text-b-900
        }

        .postbtn_like {
          @apply border-0 p-0 flex gap-x-2;

          .wrap_btn {
            @apply inline-block border-0;

            button,
            button[data-entry-id],
            .uoc-count {
              &::before {
                @apply font-bold text-sm;
              }
            }

            .ico_like,
            .ico_share,
            .ico_statistics,
            .ico_etc {
              @apply text-hidden bg-none;
            }

            &[id^=reaction-] button {
              @apply w-16 h-9 rounded-md bg-h-700/60 hover:bg-h-yellow dark:bg-b-350 hover:dark:bg-b-purple;

              .uoc-icon {
                @apply text-h-400 dark:text-b-900;
              }

              .uoc-count {
                @apply font-bold leading-none;

                &::before {
                  @apply text-sm mr-1.5 fa-heart;
                }
              }
            }

            &[id^=reaction-] button:hover {
              .uoc-icon {
                @apply text-h-200 dark:text-b-900;
              }
            }

            &.wrap_btn_share .btn_share::before {
              @apply fa-share-nodes;
            }

            button[data-entry-id] {
              &::before {
                @apply fa-chart-pie;
              }
            }

            &.wrap_btn_etc {
              .btn_etc1::before {
                @apply fa-wrench;
              }

              .btn_etc2::before {
                @apply fa-ellipsis;
              }
            }
          }
        }
      }
    }

style(once='content-tistory-ccl-layer')
  :postcss
    #tistoryCclLayer {
      @apply shadow-none border-0 bg-h-800 dark:bg-b-200 text-h-200 dark:text-b-900 rounded-md;

      span {
        @apply text-h-200 dark:text-b-900;
      }

      .ico_arrbt {
        @apply hidden;
      }
    }

style(once='content-tistory-layer')
  :postcss
    #tistorySnsLayer,
    #tistoryEtcLayer {
      @apply rounded-md shadow-none bg-h-800 dark:bg-b-200;

      .btn_mark {
        @apply text-h-200 dark:text-b-900;

        &:hover {
          @apply bg-h-700 dark:bg-b-700 text-h-200 dark:text-b-900;
        }
      }

      .ico_arrbt {
        @apply hidden;
      }

      .bundle_post a {
        @apply text-h-400 dark:text-b-400 no-underline;
      }
    }
